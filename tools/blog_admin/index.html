<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meum Diarium ‚Äì Blog Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #208090;
            --primary-dark: #1a6475;
            --primary-light: #4a9baa;
            --bg: #f8f9fa;
            --surface: #ffffff;
            --text: #2c3e50;
            --text-secondary: #7f8c8d;
            --border: #ecf0f1;
            --danger: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --info: #3498db;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        header .nav {
            display: flex;
            gap: 1rem;
        }

        header .nav a {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            text-decoration: none;
            color: white;
            font-weight: 500;
            transition: background 0.2s;
        }

        header .nav a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        header .nav a.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Main Layout */
        .container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        aside {
            background: var(--surface);
            border-right: 2px solid var(--border);
            padding: 2rem 0;
            overflow-y: auto;
            max-height: calc(100vh - 70px);
        }

        .nav-group {
            margin-bottom: 2rem;
        }

        .nav-group-title {
            padding: 0.75rem 1.5rem;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-item {
            display: block;
            padding: 0.75rem 1.5rem;
            color: var(--text);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-item.active {
            background: var(--bg);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 600;
        }

        /* Main Content */
        main {
            padding: 2rem;
            overflow-y: auto;
            max-height: calc(100vh - 70px);
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(32, 128, 144, 0.3);
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        /* Posts Grid */
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 1.5rem;
        }

        .post-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .post-card:hover {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            transform: translateY(-6px);
            border-color: var(--primary);
        }

        .post-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .post-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .post-meta {
            font-size: 0.875rem;
            opacity: 0.9;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .post-body {
            padding: 1.5rem;
        }

        .post-excerpt {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tag {
            display: inline-block;
            background: var(--bg);
            color: var(--primary);
            padding: 0.35rem 0.85rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .tag.translation {
            background: rgba(32, 128, 144, 0.15);
            border: 1px solid rgba(32, 128, 144, 0.3);
        }

        .post-actions {
            display: flex;
            gap: 0.5rem;
        }

        .post-actions .btn {
            flex: 1;
            text-align: center;
            margin: 0;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .modal-close:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 1.5rem;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
            font-size: 0.95rem;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.85rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(32, 128, 144, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Translations Section */
        .translations-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .translation-toggles {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            user-select: none;
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .language-section {
            background: var(--bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
            border-left: 4px solid var(--primary);
        }

        .subsection-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        /* Search & Filter */
        .search-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .search-input {
            flex: 1;
            padding: 0.85rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(32, 128, 144, 0.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }

            aside {
                display: none;
            }

            header {
                flex-direction: column;
                gap: 1rem;
            }

            .posts-grid {
                grid-template-columns: 1fr;
            }

            .page-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .modal-content {
                width: 95%;
                max-width: 100%;
            }

            .translation-toggles {
                flex-direction: column;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Alert */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Stats */
        .post-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            padding-top: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* SEO Preview */
        .seo-preview {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
            font-family: Arial, sans-serif;
        }

        .seo-preview-title {
            color: #1a0dab;
            font-size: 1.25rem;
            text-decoration: none;
            display: block;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .seo-preview-url {
            color: #006621;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .seo-preview-desc {
            color: #545454;
            font-size: 0.875rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .char-counter {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 0.25rem;
        }

        .char-counter.warning {
            color: var(--warning);
        }

        .char-counter.danger {
            color: var(--danger);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <a href="/" class="logo">üìú Meum Diarium</a>
        <h1 style="font-size: 1rem; margin: 0; flex: 1; text-align: center;">Blog Admin Dashboard</h1>
        <div class="nav">
            <a href="index.html" class="active">Beitr√§ge</a>
            <a href="lexicon.html">Lexikon</a>
            <a href="authors.html">Autoren</a>
            <a href="works.html">Werke</a>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openNewPostModal()"
                style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white;">‚ûï
                Neuer Beitrag</button>
        </div>
    </header>

    <div class="container">
        <!-- Sidebar -->
        <aside>
            <div class="nav-group">
                <div class="nav-group-title">üìã Navigation</div>
                <a href="#" class="nav-item active" onclick="viewPosts(); return false;">Alle Beitr√§ge</a>
            </div>
            <div class="nav-group">
                <div class="nav-group-title">üë§ Autoren</div>
                <a href="#" class="nav-item" onclick="filterAuthor('caesar'); return false;">üó°Ô∏è Caesar</a>
                <a href="#" class="nav-item" onclick="filterAuthor('cicero'); return false;">üì¢ Cicero</a>
                <a href="#" class="nav-item" onclick="filterAuthor('augustus'); return false;">üëë Augustus</a>
                <a href="#" class="nav-item" onclick="filterAuthor('seneca'); return false;">üßò Seneca</a>
            </div>
        </aside>

        <!-- Main Content -->
        <main>
            <div class="page-header">
                <h2 class="page-title">Blog Beitr√§ge</h2>
            </div>

            <!-- Search/Filter -->
            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput"
                    placeholder="üîç Nach Titel, Excerpt oder Tags suchen..." onkeyup="searchPosts()">
            </div>

            <!-- Posts Container -->
            <div id="postsContainer" class="posts-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Beitr√§ge werden geladen...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- New/Edit Post Modal -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="postModalTitle">Neuer Beitrag</h2>
                <button class="modal-close" onclick="closePostModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="postForm" onsubmit="savePost(event)">
                    <input type="hidden" id="postId" />
                    <!-- Autor -->
                    <div class="form-group">
                        <label class="form-label">üë§ Autor</label>
                        <select class="form-select" id="postAuthor" required>
                            <option value="caesar">üó°Ô∏è Caesar</option>
                            <option value="cicero">üì¢ Cicero</option>
                            <option value="augustus">üëë Augustus</option>
                            <option value="seneca">üßò Seneca</option>
                        </select>
                    </div>

                    <!-- Titel -->
                    <div class="form-group">
                        <label class="form-label">üìù Titel (DE)</label>
                        <input type="text" class="form-input" id="postTitle" placeholder="Beitragstitel eingeben..."
                            required oninput="updateSeoPreview()">
                        <div id="titleCounter" class="char-counter">0 / 60</div>
                    </div>

                    <!-- SEO Title (Optional) -->
                    <div class="form-group">
                        <label class="form-label">üîç SEO-Titel (Optional)</label>
                        <input type="text" class="form-input" id="postSeoTitle"
                            placeholder="Falls abweichend von Titel..." oninput="updateSeoPreview()">
                    </div>

                    <!-- Excerpt -->
                    <div class="form-group">
                        <label class="form-label">‚úÇÔ∏è Kurzbeschreibung (DE)</label>
                        <textarea class="form-textarea" id="postExcerpt"
                            placeholder="Kurzbeschreibung f√ºr die Vorschau..." required
                            oninput="updateSeoPreview()"></textarea>
                        <div id="excerptCounter" class="char-counter">0 / 160</div>
                    </div>

                    <!-- SEO Description (Optional) -->
                    <div class="form-group">
                        <label class="form-label">üîç SEO-Beschreibung (Optional)</label>
                        <textarea class="form-textarea" id="postSeoDesc"
                            placeholder="Falls abweichend von Kurzbeschreibung..."
                            oninput="updateSeoPreview()"></textarea>
                    </div>

                    <!-- Historisches Datum -->
                    <div class="form-group">
                        <label class="form-label">üìÖ Historisches Datum</label>
                        <input type="text" class="form-input" id="postHistDate"
                            placeholder="z.B. 52 v. Chr. oder 14 n. Chr." required>
                    </div>

                    <!-- Historisches Jahr -->
                    <div class="form-group">
                        <label class="form-label">üèõÔ∏è Historisches Jahr</label>
                        <input type="number" class="form-input" id="postHistYear"
                            placeholder="negativ=v. Chr., positiv=n. Chr." required>
                    </div>

                    <!-- Inhalt Tagebuch -->
                    <div class="form-group">
                        <label class="form-label">üìñ Inhalt ‚Äì Tagebuch (DE)</label>
                        <textarea class="form-textarea" id="postDiary"
                            placeholder="Pers√∂nliche Perspektive und Tagebuch-Eintr√§ge..." required></textarea>
                    </div>

                    <!-- Inhalt Wissenschaftlich -->
                    <div class="form-group">
                        <label class="form-label">üî¨ Inhalt ‚Äì Wissenschaftlich (DE)</label>
                        <textarea class="form-textarea" id="postScientific"
                            placeholder="Historischer Kontext und wissenschaftliche Analyse..." required></textarea>
                    </div>

                    <!-- Tags -->
                    <div class="form-group">
                        <label class="form-label">üè∑Ô∏è Tags (Kommagetrennt)</label>
                        <input type="text" class="form-input" id="postTags"
                            placeholder="z.B. Ereignis, Politik, Krieg, Rom">
                    </div>

                    <!-- Cover Image -->
                    <div class="form-group">
                        <label class="form-label">üñºÔ∏è Cover-Image URL</label>
                        <input type="text" class="form-input" id="postCover" value="/images/post-default.jpg"
                            placeholder="/images/...">
                    </div>

                    <!-- SEO Preview Section -->
                    <div class="translations-section">
                        <h3 class="section-title">üîç Google-Vorschau</h3>
                        <div class="seo-preview">
                            <div class="seo-preview-url" id="previewUrl">https://meum-diarium.de/...</div>
                            <div class="seo-preview-title" id="previewTitle">Titel-Vorschau</div>
                            <div class="seo-preview-desc" id="previewDesc">Beschreibungsvorschau...</div>
                        </div>
                    </div>

                    <!-- Translations Section -->
                    <div class="translations-section">
                        <h3 class="section-title">üåç √úbersetzungen (Optional)</h3>

                        <div class="translation-toggles">
                            <label class="checkbox-label">
                                <input type="checkbox" id="enableEnglish" onchange="toggleLanguage('en')">
                                üá¨üáß Englisch hinzuf√ºgen
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="enableLatin" onchange="toggleLanguage('la')">
                                üá±üá¶ Latein hinzuf√ºgen
                            </label>
                        </div>

                        <!-- English Translation -->
                        <div id="englishSection" class="language-section" style="display: none;">
                            <h4 class="subsection-title">English Translation</h4>

                            <div class="form-group">
                                <label class="form-label">Title (EN)</label>
                                <input type="text" class="form-input" id="postTitleEN" placeholder="English title...">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Excerpt (EN)</label>
                                <textarea class="form-textarea" id="postExcerptEN"
                                    placeholder="English excerpt..."></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Content ‚Äì Diary (EN)</label>
                                <textarea class="form-textarea" id="postDiaryEN"
                                    placeholder="English diary content..."></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Content ‚Äì Scientific (EN)</label>
                                <textarea class="form-textarea" id="postScientificEN"
                                    placeholder="English scientific content..."></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Tags (EN, Kommagetrennt)</label>
                                <input type="text" class="form-input" id="postTagsEN" placeholder="English tags...">
                            </div>
                        </div>

                        <!-- Latin Translation -->
                        <div id="latinSection" class="language-section" style="display: none;">
                            <h4 class="subsection-title">Latinum Translatio</h4>

                            <div class="form-group">
                                <label class="form-label">Titulus (LA)</label>
                                <input type="text" class="form-input" id="postTitleLA" placeholder="Titulus Latinus...">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Excerptum (LA)</label>
                                <textarea class="form-textarea" id="postExcerptLA"
                                    placeholder="Excerptum Latinum..."></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Contentus ‚Äì Diarium (LA)</label>
                                <textarea class="form-textarea" id="postDiaryLA"
                                    placeholder="Diarium Latinum..."></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Contentus ‚Äì Scientificum (LA)</label>
                                <textarea class="form-textarea" id="postScientificLA"
                                    placeholder="Analisis Latina..."></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Labellae (LA, comma separata)</label>
                                <input type="text" class="form-input" id="postTagsLA" placeholder="Labellae Latinae...">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePostModal()">Abbrechen</button>
                <button class="btn btn-primary"
                    onclick="document.getElementById('postForm').dispatchEvent(new Event('submit'))">‚úÖ
                    Speichern</button>
            </div>
        </div>
    </div>

    <script>
        let allPosts = [];
        let filteredPosts = [];
        let currentEditingId = null;

        // Load posts on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadPosts();
        });

        async function loadPosts() {
            try {
                const response = await fetch('/api/posts');
                allPosts = await response.json();
                filteredPosts = allPosts;
                renderPosts();
            } catch (error) {
                console.error('Error loading posts:', error);
                document.getElementById('postsContainer').innerHTML =
                    '<div class="alert alert-danger" style="grid-column: 1/-1;">‚ùå Fehler beim Laden der Beitr√§ge</div>';
            }
        }

        function renderPosts() {
            const container = document.getElementById('postsContainer');

            if (filteredPosts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üì≠</div>
                        <h3>Keine Beitr√§ge gefunden</h3>
                        <p>Erstelle deinen ersten Beitrag um zu beginnen</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredPosts.map(post => {
                const hasTranslations = (post.title_en || post.title_la) ? true : false;
                const translationTags = [];
                if (post.title_en) translationTags.push('EN');
                if (post.title_la) translationTags.push('LA');

                return `
                    <div class="post-card">
                        <div class="post-header">
                            <div class="post-title">${post.title || 'Untitled'}</div>
                            <div class="post-meta">
                                <span>üë§ ${post.author}</span>
                                <span>üìÖ ${post.date || 'N/A'}</span>
                            </div>
                        </div>
                        <div class="post-body">
                            <p class="post-excerpt">${post.excerpt || 'Keine Beschreibung'}</p>
                            <div class="post-tags">
                                ${(post.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                                ${translationTags.map(t => `<span class="tag translation">üåç ${t}</span>`).join('')}
                            </div>
                            <div class="post-stats">
                                <div class="stat">‚è±Ô∏è ${post.readingTime || '5'} min</div>
                                <div class="stat">üìñ ${post.historicalYear >= 0 ? post.historicalYear + ' n. Chr.' : Math.abs(post.historicalYear) + ' v. Chr.'}</div>
                            </div>
                            <div class="post-actions" style="margin-top: 1rem;">
                                <button class="btn btn-secondary btn-sm" onclick="editPost('${post.id}')">‚úèÔ∏è Bearbeiten</button>
                                <button class="btn btn-danger btn-sm" onclick="deletePost('${post.id}')">üóëÔ∏è L√∂schen</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openNewPostModal() {
            document.getElementById('postModalTitle').textContent = 'üìù Neuer Beitrag';
            document.getElementById('postForm').reset();
            resetLanguageSections();
            document.getElementById('postId').value = '';
            currentEditingId = null;
            document.getElementById('postModal').classList.add('active');
            updateSeoPreview();
        }

        function closePostModal() {
            document.getElementById('postModal').classList.remove('active');
            currentEditingId = null;
        }

        function toggleLanguage(lang) {
            if (lang === 'en') {
                const section = document.getElementById('englishSection');
                section.style.display = document.getElementById('enableEnglish').checked ? 'block' : 'none';
            } else if (lang === 'la') {
                const section = document.getElementById('latinSection');
                section.style.display = document.getElementById('enableLatin').checked ? 'block' : 'none';
            }
        }

        function resetLanguageSections() {
            document.getElementById('enableEnglish').checked = false;
            document.getElementById('enableLatin').checked = false;
            document.getElementById('englishSection').style.display = 'none';
            document.getElementById('latinSection').style.display = 'none';
        }

        async function savePost(event) {
            event.preventDefault();

            const post = {
                id: document.getElementById('postId').value || undefined,
                author: document.getElementById('postAuthor').value,
                title_de: document.getElementById('postTitle').value,
                excerpt_de: document.getElementById('postExcerpt').value,
                historicalDate: document.getElementById('postHistDate').value,
                historicalYear: parseInt(document.getElementById('postHistYear').value),
                content_de_diary: document.getElementById('postDiary').value,
                content_de_scientific: document.getElementById('postScientific').value,
                tags: document.getElementById('postTags').value.split(',').map(t => t.trim()).filter(t => t),
                coverImage: document.getElementById('postCover').value,
                seoTitle: document.getElementById('postSeoTitle').value || undefined,
                seoDescription: document.getElementById('postSeoDesc').value || undefined,
                date: new Date().toISOString().split('T')[0]
            };

            // EN
            if (document.getElementById('enableEnglish').checked) {
                post.title_en = document.getElementById('postTitleEN').value;
                post.excerpt_en = document.getElementById('postExcerptEN').value;
                post.content_en_diary = document.getElementById('postDiaryEN').value;
                post.content_en_scientific = document.getElementById('postScientificEN').value;
                post.tags_en = document.getElementById('postTagsEN').value.split(',').map(t => t.trim()).filter(t => t);
            }

            // LA
            if (document.getElementById('enableLatin').checked) {
                post.title_la = document.getElementById('postTitleLA').value;
                post.excerpt_la = document.getElementById('postExcerptLA').value;
                post.content_la_diary = document.getElementById('postDiaryLA').value;
                post.content_la_scientific = document.getElementById('postScientificLA').value;
                post.tags_la = document.getElementById('postTagsLA').value.split(',').map(t => t.trim()).filter(t => t);
            }

            try {
                let url = '/api/posts';
                let method = 'POST';
                if (currentEditingId || post.id) {
                    const id = currentEditingId || post.id;
                    url = `/api/posts/${id}`;
                    method = 'PUT';
                }
                const response = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(post)
                });

                if (response.ok) {
                    alert('‚úÖ Beitrag erfolgreich gespeichert!');
                    closePostModal();
                    loadPosts();
                } else {
                    alert('‚ùå Fehler beim Speichern');
                }
            } catch (error) {
                console.error('Error saving post:', error);
                alert('‚ùå Fehler beim Speichern des Beitrags');
            }
        }

        async function deletePost(id) {
            if (!confirm('‚ö†Ô∏è Wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) return;

            try {
                const response = await fetch(`/api/posts/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('‚úÖ Beitrag gel√∂scht');
                    loadPosts();
                } else {
                    alert('‚ùå Fehler beim L√∂schen');
                }
            } catch (error) {
                console.error('Error deleting post:', error);
                alert('‚ùå Fehler beim L√∂schen des Beitrags');
            }
        }

        function editPost(id) {
            const post = allPosts.find(p => p.id === id);
            if (!post) return;

            document.getElementById('postModalTitle').textContent = '‚úèÔ∏è Beitrag bearbeiten';
            document.getElementById('postId').value = post.id || '';
            document.getElementById('postAuthor').value = post.author;
            document.getElementById('postTitle').value = post.title || '';
            document.getElementById('postExcerpt').value = post.excerpt || '';
            document.getElementById('postHistDate').value = post.historicalDate || '';
            document.getElementById('postHistYear').value = post.historicalYear || '';
            document.getElementById('postDiary').value = post.content_de_diary || '';
            document.getElementById('postScientific').value = post.content_de_scientific || '';
            document.getElementById('postTags').value = (post.tags || []).join(', ');
            document.getElementById('postCover').value = post.coverImage || '/images/post-default.jpg';
            document.getElementById('postSeoTitle').value = post.seoTitle || '';
            document.getElementById('postSeoDesc').value = post.seoDescription || '';

            // EN
            if (post.title_en) {
                document.getElementById('enableEnglish').checked = true;
                document.getElementById('englishSection').style.display = 'block';
                document.getElementById('postTitleEN').value = post.title_en || '';
                document.getElementById('postExcerptEN').value = post.excerpt_en || '';
                document.getElementById('postDiaryEN').value = post.content_en_diary || '';
                document.getElementById('postScientificEN').value = post.content_en_scientific || '';
                document.getElementById('postTagsEN').value = (post.tags_en || []).join(', ');
            }

            // LA
            if (post.title_la) {
                document.getElementById('enableLatin').checked = true;
                document.getElementById('latinSection').style.display = 'block';
                document.getElementById('postTitleLA').value = post.title_la || '';
                document.getElementById('postExcerptLA').value = post.excerpt_la || '';
                document.getElementById('postDiaryLA').value = post.content_la_diary || '';
                document.getElementById('postScientificLA').value = post.content_la_scientific || '';
                document.getElementById('postTagsLA').value = (post.tags_la || []).join(', ');
            }

            document.getElementById('postModal').classList.add('active');
            currentEditingId = post.id;
            updateSeoPreview();
        }

        function searchPosts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            filteredPosts = allPosts.filter(post =>
                (post.title || '').toLowerCase().includes(query) ||
                (post.excerpt || '').toLowerCase().includes(query) ||
                (post.historicalDate || '').toLowerCase().includes(query) ||
                (post.tags || []).some(tag => tag.toLowerCase().includes(query))
            );
            renderPosts();
        }

        function filterAuthor(author) {
            filteredPosts = allPosts.filter(post => post.author === author);
            document.getElementById('searchInput').value = '';
            renderPosts();

            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const links = Array.from(document.querySelectorAll('.nav-item'));
            const match = links.find(a => a.textContent.toLowerCase().includes(author));
            if (match) match.classList.add('active');
        }

        function viewPosts() {
            filteredPosts = allPosts;
            document.getElementById('searchInput').value = '';
            renderPosts();

            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelector('.nav-item:first-of-type').classList.add('active');
        }

        function updateSeoPreview() {
            const title = document.getElementById('postSeoTitle').value || document.getElementById('postTitle').value;
            const excerpt = document.getElementById('postSeoDesc').value || document.getElementById('postExcerpt').value;
            const author = document.getElementById('postAuthor').value;

            // Counters
            const titleCount = title.length;
            const excerptCount = excerpt.length;

            const titleEl = document.getElementById('titleCounter');
            const excerptEl = document.getElementById('excerptCounter');

            titleEl.textContent = `${titleCount} / 60`;
            excerptEl.textContent = `${excerptCount} / 160`;

            // Stats colors
            titleEl.className = 'char-counter ' + (titleCount > 60 ? 'danger' : titleCount > 50 ? 'success' : 'warning');
            excerptEl.className = 'char-counter ' + (excerptCount > 160 ? 'danger' : excerptCount > 140 ? 'success' : 'warning');

            // Preview
            document.getElementById('previewTitle').textContent = title || 'Titel-Vorschau';
            document.getElementById('previewDesc').textContent = excerpt || 'Beschreibungsvorschau...';
            document.getElementById('previewUrl').textContent = `https://meum-diarium.de/${author}/posts/...`;
        }
    </script>
</body>

</html>